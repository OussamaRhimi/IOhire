@startuml
title Sprint 4 - Class Diagram

skinparam classAttributeIconSize 0
skinparam shadowing false
skinparam linetype ortho
left to right direction

class Visitor <<anonymous>> {
  +sessionId: string
}

class HRUser <<Strapi Admin>> {
  +email: string
  +role: string
}

class Candidate {
  +id: int
  +status: ApplicationStatus
  +score: decimal
  +createdAt: datetime
  +updatedAt: datetime
}

class JobPosting {
  +id: int
  +title: string
  +status: JobPostingStatus
  +requirements: Requirements
}

class Requirements <<value object>> {
  +skillsRequired: string[*]
  +skillsNiceToHave: string[*]
}

class EvaluationConfig <<value object>> {
  +fitWeight: int
  +completenessWeight: int
  +fitSubWeights: json
  +completenessPoints: json
  +qualityThresholds: json
  +customCriteria: CustomCriterion[*]
}

class AnalyticsSnapshot <<transient>> {
  +totalJobPostings: int
  +totalCandidates: int
  +averageScore: decimal
  +statusDistribution: json
  +scoreHistogram: json
  +submissionsOverTime: json
}

class BulkStatusCommand <<transient>> {
  +candidateIds: int[*]
  +targetStatus: ApplicationStatus
}

class JobRecommendation <<transient>> {
  +jobId: int
  +title: string
  +compatibility: decimal
  +matchedRequired: string[*]
  +missingRequired: string[*]
  +matchedNiceToHave: string[*]
  +missingNiceToHave: string[*]
}

class ChatSession <<transient>> {
  +messages: ChatMessage[*]
  +maxHistory: int = 20
}

class ChatMessage <<transient>> {
  +role: ChatRole
  +content: string
}

class AIProcessor <<service>> {
  +recommendJobPostings(resume: Media): JobRecommendation[*]
}

HRUser "1" --> "0..*" Candidate : reviews >
HRUser ..> AnalyticsSnapshot : views >
Candidate "*" --> "1" JobPosting : applies to >
JobPosting "1" *-- "1" Requirements : contains >
Requirements "0..1" *-- "0..1" EvaluationConfig : configures >

Visitor ..> JobRecommendation : requests >
Visitor ..> ChatSession : chats >

BulkStatusCommand ..> Candidate : updates status >
AnalyticsSnapshot ..> Candidate : aggregates >
AnalyticsSnapshot ..> JobPosting : aggregates >
ChatSession "1" *-- "1..*" ChatMessage : contains >
AIProcessor ..> JobRecommendation : produces >
AIProcessor ..> ChatSession : responds to >
JobRecommendation "*" --> "1" JobPosting : targets >

enum ApplicationStatus {
  new
  processing
  processed
  reviewing
  shortlisted
  rejected
  hired
  error
}

enum JobPostingStatus {
  draft
  open
  closed
}

enum QualityLabel {
  excellent
  good
  fair
  poor
}

enum ChatRole {
  user
  assistant
}

@enduml
