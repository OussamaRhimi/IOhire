@startuml
title IOhire - Full Class Diagram

skinparam classAttributeIconSize 0
skinparam shadowing false
skinparam linetype ortho
left to right direction

'======================
' Actors
'======================
class Visitor <<anonymous>> {
  +sessionId: string
}

class HRUser <<Strapi Admin>> {
  +email: string
  +password: string
  +role: string
}

'======================
' Core entities
'======================
class Candidate {
  +id: int
  +fullName: string
  +email: email
  +linkedin: string
  +portfolio: string
  +resume: Media
  +status: ApplicationStatus
  +score: decimal
  +publicToken: string
  +consent: boolean
  +consentAt: datetime
  +retentionUntil: datetime
  +hrNotes: text
  +extractedData: json
  +standardizedCvMarkdown: text
  +cvTemplateKey: CvTemplateKey
  +createdAt: datetime
  +updatedAt: datetime
}

class JobPosting {
  +id: int
  +title: string
  +description: text
  +requirements: Requirements
  +status: JobPostingStatus
  +createdAt: datetime
  +updatedAt: datetime
}

class Skill {
  +id: int
  +name: string <<unique>>
}

class Department {
  +id: int
  +name: string <<unique>>
}

'======================
' Embedded value objects (JSON)
'======================
class Requirements <<value object>> {
  +skillsRequired: string[*]
  +skillsNiceToHave: string[*]
  +departments: string[*]
  +minYearsExperience: int
  +notes: string
}

class EvaluationConfig <<value object>> {
  +fitWeight: int
  +completenessWeight: int
  +fitSubWeights: json
  +completenessPoints: json
  +qualityThresholds: json
  +customCriteria: CustomCriterion[*]
}

class CVTemplate <<catalog>> {
  +key: CvTemplateKey
  +name: string
  +description: string
}

'======================
' AI service
'======================
class AIProcessor <<service>> {
  +processCandidate(candidateId: int): void
  +extractResumeText(resume: Media): string
  +parseCV(text: string): json
  +evaluateFit(data: json, req: Requirements): decimal
  +generateStandardizedCV(data: json, template: CVTemplate): text
  +recommendJobPostings(resume: Media): JobRecommendation[*]
}

class JobRecommendation <<transient>> {
  +jobId: int
  +title: string
  +compatibility: decimal
  +matchedRequired: string[*]
  +missingRequired: string[*]
  +matchedNiceToHave: string[*]
  +missingNiceToHave: string[*]
}

class AnalyticsSnapshot <<transient>> {
  +totalJobPostings: int
  +totalCandidates: int
  +averageScore: decimal
  +statusDistribution: json
  +scoreHistogram: json
  +submissionsOverTime: json
}

class ChatSession <<transient>> {
  +messages: ChatMessage[*]
  +maxHistory: int = 20
  +maxMsgLength: int = 1000
}

class ChatMessage <<transient>> {
  +role: ChatRole
  +content: string
}

'======================
' Relationships
'======================
Candidate "*" --> "1" JobPosting : applies to >
JobPosting "1" *-- "1" Requirements : contains >
Requirements "0..1" *-- "0..1" EvaluationConfig : configures >
Requirements "0..*" ..> "0..*" Skill : references >
Requirements "0..*" ..> "0..*" Department : references >

HRUser "1" --> "0..*" JobPosting : manages >
HRUser "1" --> "0..*" Candidate : reviews >
HRUser ..> AnalyticsSnapshot : views >

AnalyticsSnapshot ..> Candidate : aggregates >
AnalyticsSnapshot ..> JobPosting : aggregates >

Visitor ..> JobPosting : browses (open) >
Visitor ..> Candidate : submits / tracks / deletes >
Visitor ..> JobRecommendation : requests >
Visitor ..> ChatSession : chats >

ChatSession "1" *-- "1..*" ChatMessage : contains >
AIProcessor ..> ChatSession : responds to >

Candidate "1" --> "0..1" CVTemplate : uses >
AIProcessor ..> Candidate : processes >
AIProcessor ..> JobPosting : queries >
AIProcessor ..> Requirements : reads >
AIProcessor ..> EvaluationConfig : applies >
AIProcessor ..> CVTemplate : renders with >
AIProcessor ..> JobRecommendation : produces >
AIProcessor ..> ChatSession : responds to >
JobRecommendation "*" --> "1" JobPosting : targets >

'======================
' Enums
'======================
enum ApplicationStatus {
  new
  processing
  processed
  reviewing
  shortlisted
  rejected
  hired
  error
}

enum JobPostingStatus {
  draft
  open
  closed
}

enum QualityLabel {
  excellent  ' >= 80
  good       ' >= 60
  fair       ' >= 40
  poor       ' < 40
}

enum ChatRole {
  user
  assistant
}

enum CvTemplateKey {
  standard
  experience_first
  skills_first
  compact
  education_first
  project_focus
  sidebar_photo
  accent_pink
  teal_circle
  navy_gold
  sunset
}

@enduml
