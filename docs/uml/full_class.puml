@startuml
title IOhire - Full Class Diagram (Academic Domain Model)

skinparam classAttributeIconSize 0
skinparam shadowing false
skinparam linetype ortho
left to right direction

'======================
' Core users
'======================
abstract class User {
  +userId: int
  +fullName: string
  +email: string
  --
  +authenticate(password: string): boolean
  +logout(): void
}

class Candidate {
  --
  +submitApplication(jobId: int, resume: Resume): CandidateApplication
  +trackApplication(token: string): ApplicationStatus
  +deleteApplication(token: string): void
  +requestRecommendations(resume: Resume): JobRecommendation[*]
}

class HRUser {
  +email: string
  +password: string
  +role: string
  --
  +createJobPosting(data): JobPosting
  +updateJobPosting(jobId: int, patch): JobPosting
  +filterCandidates(status: ApplicationStatus, scoreRule: string, jobId: int): CandidateApplication[*]
  +applyBulkStatus(candidateIds: int[*], status: ApplicationStatus): int
}

User <|-- Candidate
User <|-- HRUser

'======================
' Recruitment entities
'======================
class JobPosting {
  +jobId: int
  +title: string
  +description: text
  +status: JobPostingStatus
  +createdAt: datetime
  +updatedAt: datetime
  --
  +openPosting(): void
  +closePosting(): void
  +updateDetails(title: string, description: text): void
}

class JobRequirement {
  +skillsRequired: string[*]
  +skillsNiceToHave: string[*]
  +departments: string[*]
  +minYearsExperience: int
  +notes: string
  --
  +addRequiredSkill(skill: string): void
  +removeRequiredSkill(skill: string): void
  +addDepartment(department: string): void
  +setMinYearsExperience(years: int): void
}

class Skill {
  +skillId: int
  +name: string
  --
  +add(name: string): Skill
  +update(name: string): void
  +delete(): void
  +search(query: string): Skill[*]
}

class Department {
  +departmentId: int
  +name: string
  --
  +add(name: string): Department
  +update(name: string): void
  +delete(): void
  +search(query: string): Department[*]
}

class CandidateApplication <<association class>> {
  +applicationId: int
  +publicToken: string
  +consent: boolean
  +consentAt: datetime
  +retentionUntil: datetime
  +status: ApplicationStatus
  +score: decimal
  +hrNotes: text
  +createdAt: datetime
  +updatedAt: datetime
  --
  +setStatus(status: ApplicationStatus): void
  +setScore(score: decimal): void
  +setHRNotes(notes: text): void
  +markRetention(until: datetime): void
}

class Resume {
  +fileId: int
  +fileName: string
  +url: string
  +mimeType: string
  +sizeBytes: long
  --
  +validateType(): boolean
  +validateSize(maxBytes: long): boolean
}

Candidate "1" -- "0..*" JobPosting : appliesFor >
(Candidate, JobPosting) .. CandidateApplication

HRUser "1" -- "0..*" JobPosting : manages >
HRUser "1" -- "0..*" CandidateApplication : reviews >

JobPosting "1" *-- "1" JobRequirement
JobRequirement "0..*" -- "0..*" Skill : uses >
JobRequirement "0..*" -- "0..*" Department : uses >

CandidateApplication "1" *-- "1" Resume

'======================
' AI-related domain classes
'======================
class ExtractedData {
  +summary: string
  +skills: string[*]
  +languages: string[*]
  +projects: string[*]
  +missingFields: string[*]
  --
  +normalizeSkills(): void
  +mergeFromParser(raw): void
}

class EvaluationReport {
  +fitScore: decimal
  +completenessScore: decimal
  +totalScore: decimal
  +missingSkills: string[*]
  +missingFields: string[*]
  +notes: string
  --
  +calculateTotal(): decimal
}

class StandardizedCV {
  +markdown: text
  +templateKey: CvTemplateKey
  +generatedAt: datetime
  --
  +renderMarkdown(): text
}

class CVTemplate {
  +key: CvTemplateKey
  +name: string
  +description: string
  --
  +render(content: ExtractedData): StandardizedCV
}

class RecommendationRequest {
  +resumeMimeType: string
  +resumeSizeBytes: long
  --
  +isValid(): boolean
}

class SkillProfile {
  +skills: string[*]
  +source: string
  --
  +dedupe(): void
}

class JobRecommendation {
  +compatibility: decimal
  +matchedRequired: string[*]
  +missingRequired: string[*]
  +matchedNiceToHave: string[*]
  +missingNiceToHave: string[*]
  --
  +computeCompatibility(): decimal
}

class AIProcessor <<AI>> {
  +processApplication(appId: int): void
  +extractResumeText(resume: Resume): string
  +parseCV(text: string): ExtractedData
  +evaluateFit(data: ExtractedData, req: JobRequirement): EvaluationReport
  +generateStandardCV(data: ExtractedData, template: CVTemplate): StandardizedCV
}

class RecommendationEngine <<AI>> {
  +extractSkills(req: RecommendationRequest): SkillProfile
  +rankOpenJobs(skills: SkillProfile, jobs: JobPosting[*]): JobRecommendation[*]
  +topMatches(ranked: JobRecommendation[*]): JobRecommendation[*]
}

CandidateApplication "1" o-- "0..1" ExtractedData
CandidateApplication "1" o-- "0..1" EvaluationReport
CandidateApplication "1" o-- "0..1" StandardizedCV
StandardizedCV "1" --> "1" CVTemplate : basedOn >

AIProcessor ..> CandidateApplication : updates status/score >
AIProcessor ..> Resume
AIProcessor ..> JobRequirement
AIProcessor ..> ExtractedData
AIProcessor ..> EvaluationReport
AIProcessor ..> StandardizedCV
AIProcessor ..> CVTemplate

RecommendationEngine ..> RecommendationRequest
RecommendationEngine ..> SkillProfile
RecommendationEngine ..> JobPosting
RecommendationEngine ..> JobRecommendation
JobRecommendation "*" --> "1" JobPosting : targets >
Candidate ..> JobRecommendation : views >

'======================
' Enums
'======================
enum ApplicationStatus {
  new
  processing
  processed
  reviewing
  shortlisted
  rejected
  hired
  error
}

enum JobPostingStatus {
  draft
  open
  closed
}

enum CvTemplateKey {
  standard
  experience_first
  skills_first
  compact
  education_first
  project_focus
  sidebar_photo
  accent_pink
  teal_circle
  navy_gold
  sunset
}

@enduml
